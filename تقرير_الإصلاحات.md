# ๐ ุชูุฑูุฑ ุฅุตูุงุญ ุฃุฎุทุงุก ุงูุงุชุตุงู - my-cordova-api-new

## ๐ฏ ููุฎุต ุงูุชุญุฏูุซุงุช

ุชู ุฅุตูุงุญ **ุฌููุน ุฃุฎุทุงุก ุงูุงุชุตุงู** ุจูู ุชุทุจูู Cordova ูุงูุณูุฑูุฑ ุจูุฌุงุญ! โ

---

## ๐ง ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. โ ุงููุดููุฉ: "failed to analyze, please try again"
**ุงูุณุจุจ**: ููู `analyze.js` ูุงู ูุญุชูู ุนูู server-side code ุจุฏูุงู ูู client-side code

**ุงูุญู**: 
- ุชุญููู `analyze.js` ุฅูู client-side ูุฑุณู ุทูุจุงุช POST ุฅูู ุงูุณูุฑูุฑ
- ุฅูุดุงุก `server-handlers/analyze.handler.js` ููุณูุฑูุฑ
- ุฌููุน ุงูุทูุจุงุช ุงูุขู ุชุฐูุจ ุฅูู: `https://my-cordova.onrender.com/analyze`

---

### 2. โ ุงููุดููุฉ: "Sorry, chat service is currently unavailable"
**ุงูุณุจุจ**: ููู `doctor.js` ูุงู ูุญุชูู ุนูู server-side code ุจุฏูุงู ูู client-side code

**ุงูุญู**:
- ุชุญููู `doctor.js` ุฅูู client-side ูุฑุณู ุทูุจุงุช POST ุฅูู ุงูุณูุฑูุฑ
- ุฅูุดุงุก `server-handlers/doctor.handler.js` ููุณูุฑูุฑ
- ุฌููุน ุงูุทูุจุงุช ุงูุขู ุชุฐูุจ ุฅูู: `https://my-cordova.onrender.com/doctor`

---

### 3. โ ุงููุดููุฉ: ุฎูุท ุจูู Client-Side ู Server-Side Code
**ุงูุณุจุจ**: ุงููููุงุช ูุงูุช ุชุญุชูู ุนูู ููุฏ ุงูุณูุฑูุฑ ูุงูุชุทุจูู ูุนุงู

**ุงูุญู**:
- ูุตู ุชุงู ุจูู Client-Side (ุงูุชุทุจูู) ู Server-Side (ุงูุณูุฑูุฑ)
- ุฅูุดุงุก ูุฌูุฏ `server-handlers/` ููุณูุฑูุฑ ููุท
- ุงููููุงุช ุงูุฑุฆูุณูุฉ ุฃุตุจุญุช client-side ููุท

---

## ๐ ูุงุฆูุฉ ุงููููุงุช ุงููุนุฏูุฉ

### โ ูููุงุช Client-Side (ุงูุชุทุจูู)

#### 1. **config.js** - ุจุฏูู ุชุนุฏูู
- **ุงูุฏูุฑ**: ุชุฎุฒูู ุฑุงุจุท ุงูุณูุฑูุฑ ุงููุญูุฏ
- **ุงูุฑุงุจุท ุงููุณุชุฎุฏู**: `https://my-cordova.onrender.com`
- **ุงูุชุนุฏูู**: ูุง ููุฌุฏ (ูุงู ุตุญูุญุงู)

---

#### 2. **doctor.js** - ุชู ุงูุชุนุฏูู ุจุงููุงูู โ๏ธ
- **ุงูุฏูุฑ ุงููุฏูู**: Server-side handler ูุชุตู ุจู OpenAI ูุจุงุดุฑุฉ
- **ุงูุฏูุฑ ุงูุฌุฏูุฏ**: Client-side function ุชุฑุณู ุทูุจุงุช ุฅูู ุงูุณูุฑูุฑ
- **ุงูุชุนุฏููุงุช**:
  * ุฅุฒุงูุฉ `https.request` ู OpenAI API calls
  * ุฅุถุงูุฉ `sendDoctorRequest(question, language, history)`
  * ุงุณุชุฎุฏุงู `sendRequest()` ูู helper.js
  * ุฅุฑุณุงู POST ุฅูู `/doctor`
  * โ ูุง ูุญุชูู ุนูู ุฃู API Key

**ุงูุงุณุชุฎุฏุงู**:
```javascript
const { sendDoctorRequest } = require('./doctor');
const result = await sendDoctorRequest('ูุง ูู ุฃูุถู ููุช ูุฑู ุงููุจุงุชุงุชุ', 'ar');
```

---

#### 3. **analyze.js** - ุชู ุงูุชุนุฏูู ุจุงููุงูู โ๏ธ
- **ุงูุฏูุฑ ุงููุฏูู**: Server-side handler ูุชุตู ุจู OpenAI ูุจุงุดุฑุฉ
- **ุงูุฏูุฑ ุงูุฌุฏูุฏ**: Client-side function ุชุฑุณู ุทูุจุงุช ุฅูู ุงูุณูุฑูุฑ
- **ุงูุชุนุฏููุงุช**:
  * ุฅุฒุงูุฉ `https.request` ู OpenAI API calls
  * ุฅุถุงูุฉ `sendAnalyzeRequest(base64Image, language)`
  * ุงุณุชุฎุฏุงู `sendRequest()` ูู helper.js
  * ุฅุฑุณุงู POST ุฅูู `/analyze`
  * ุชูุธูู ุชููุงุฆู ููุตูุฑ ูู ุงูุจุงุฏุฆุฉ `data:image...`
  * โ ูุง ูุญุชูู ุนูู ุฃู API Key

**ุงูุงุณุชุฎุฏุงู**:
```javascript
const { sendAnalyzeRequest } = require('./analyze');
const result = await sendAnalyzeRequest(base64Image, 'ar');
```

---

#### 4. **ads.js** - ุชู ุงูุชุนุฏูู ุจุงููุงูู โ๏ธ
- **ุงูุฏูุฑ ุงููุฏูู**: Server-side handler ูุฌูุจ ูู Google Sheets
- **ุงูุฏูุฑ ุงูุฌุฏูุฏ**: Client-side function ุชุฑุณู ุทูุจุงุช ุฅูู ุงูุณูุฑูุฑ
- **ุงูุชุนุฏููุงุช**:
  * ุฅุฒุงูุฉ `https.get` ู file system operations
  * ุฅุถุงูุฉ `getAds()`
  * ุงุณุชุฎุฏุงู `sendRequest()` ูู helper.js
  * ุฅุฑุณุงู GET ุฅูู `/ads`
  * ุฅุฑุฌุงุน ููู ุงูุชุฑุงุถูุฉ ูู ุญุงูุฉ ุงููุดู

**ุงูุงุณุชุฎุฏุงู**:
```javascript
const { getAds } = require('./ads');
const adsConfig = await getAds();
```

---

#### 5. **helper.js** - ุจุฏูู ุชุนุฏูู โ
- **ุงูุฏูุฑ**: ูุธุงุฆู ูุณุงุนุฏุฉ ูุฅุฑุณุงู ุทูุจุงุช HTTP
- **ุงููุธุงุฆู**:
  * `sendRequest(endpoint, data, method)` - ุฅุฑุณุงู ุทูุจุงุช GET/POST
  * `safeJSONParse()` - ุชุญููู JSON ุจุฃูุงู
  * `isOnline()` - ุงูุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช
  * `testServerConnection()` - ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ
- **ุงูุชุนุฏูู**: ูุง ููุฌุฏ (ูุงู ุตุญูุญุงู)

---

#### 6. **api.js** - ุจุฏูู ุชุนุฏูู โ
- **ุงูุฏูุฑ**: ูุงุฌูุฉ ููุญุฏุฉ ูุฌููุน ุงููุธุงุฆู
- **ุงููุธุงุฆู**:
  * `askDoctor(question, language, history)`
  * `analyzePlant(base64Image, language)`
  * `getAdsConfig()`
  * `getServerURL()`
- **ุงูุชุนุฏูู**: ูุง ููุฌุฏ (ูุงู ุตุญูุญุงู)

---

#### 7. **index.js** - ุจุฏูู ุชุนุฏูู โ
- **ุงูุฏูุฑ**: ููุทุฉ ุงูุฏุฎูู ุงูุฑุฆูุณูุฉ
- **ุงูุชุนุฏูู**: ูุง ููุฌุฏ (ูุงู ุตุญูุญุงู)

---

### ๐ฅ๏ธ ูููุงุช Server-Side (ุงูุณูุฑูุฑ ุนูู Render)

#### 8. **server.js** - ุชู ุงูุชุนุฏูู โ๏ธ
- **ุงูุฏูุฑ**: ุงูุณูุฑูุฑ ุงูุฑุฆูุณู ุนูู Render
- **ุงูุชุนุฏููุงุช**:
  * ุชุญุฏูุซ `require('./doctor')` ุฅูู `require('./server-handlers/doctor.handler')`
  * ุชุญุฏูุซ `require('./analyze')` ุฅูู `require('./server-handlers/analyze.handler')`
  * ุชุญุฏูุซ `require('./ads')` ุฅูู `require('./server-handlers/ads.handler')`
- **ุงูููุงูุฐ ุงููุชุงุญุฉ**:
  * `GET  /` - ุญุงูุฉ ุงูุณูุฑูุฑ
  * `GET  /config` - ุงูุฅุนุฏุงุฏุงุช
  * `GET  /ads` - ุงูุฅุนูุงูุงุช
  * `POST /doctor` - ุงูุฏุฑุฏุดุฉ
  * `POST /analyze` - ุชุญููู ุงูุตูุฑ
  * `POST /api/diagnose` - ุชุญููู ุงูุตูุฑ (ุจุฏูู)

---

### ๐ ูููุงุช ุฌุฏูุฏุฉ (Server Handlers)

#### 9. **server-handlers/doctor.handler.js** - ุฌุฏูุฏ โจ
- **ุงูุฏูุฑ**: ูุนุงูุฌ ุงูุณูุฑูุฑ ููุฏุฑุฏุดุฉ
- **ุงููุธููุฉ**: 
  * ุงุณุชูุจุงู ุงูุฃุณุฆูุฉ ูู ุงูุชุทุจูู
  * ุฅุฑุณุงููุง ุฅูู OpenAI API
  * ุฅุนุงุฏุฉ ุงูุฑุฏูุฏ
- **ุงูููุงุชูุญ**: ูุณุชุฎุฏู `OPENAI_API_KEY` ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ

---

#### 10. **server-handlers/analyze.handler.js** - ุฌุฏูุฏ โจ
- **ุงูุฏูุฑ**: ูุนุงูุฌ ุงูุณูุฑูุฑ ูุชุญููู ุงูุตูุฑ
- **ุงููุธููุฉ**:
  * ุงุณุชูุจุงู ุงูุตูุฑ ูู ุงูุชุทุจูู
  * ุฅุฑุณุงููุง ุฅูู OpenAI API
  * ุงุณุชุฎุฑุงุฌ JSON ูู ุงููุชุงุฆุฌ
  * ุฅุนุงุฏุฉ ุงูุชุญููู ุงููุงูู
- **ุงูููุงุชูุญ**: ูุณุชุฎุฏู `OPENAI_API_KEY` ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ

---

#### 11. **server-handlers/ads.handler.js** - ุฌุฏูุฏ โจ
- **ุงูุฏูุฑ**: ูุนุงูุฌ ุงูุณูุฑูุฑ ููุฅุนูุงูุงุช
- **ุงููุธููุฉ**:
  * ุฌูุจ ุงูุจูุงูุงุช ูู Google Sheets
  * ุฃู ูู ููู ูุญูู ูู fallback
  * ุฅุนุงุฏุฉ ุงูุฅุนุฏุงุฏุงุช ููุชุทุจูู
- **ุงูููุงุชูุญ**: ูุณุชุฎุฏู `ADS_SHEETS_URL` ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ

---

#### 12. **STRUCTURE.md** - ุฌุฏูุฏ โจ
- **ุงูุฏูุฑ**: ุชูุซูู ุจููุฉ ุงููุดุฑูุน
- **ุงููุญุชูู**:
  * ุดุฑุญ Client-Side Files
  * ุดุฑุญ Server-Side Files
  * ุณูุฑ ุงูุนูู
  * ุงูุฃูุงู
  * ููุงุท ุงูููุงูุฉ

---

## ๐ ููุงุท ุงูููุงูุฉ (Endpoints)

### ุฌููุน ุงูุทูุจุงุช ุชุณุชุฎุฏู:
```
https://my-cordova.onrender.com
```

### ุงูููุงูุฐ ุงููุชุงุญุฉ:

| ุงููููุฐ | ุงูููุน | ุงููุธููุฉ | ุงูุงุณุชุฎุฏุงู |
|--------|------|---------|-----------|
| `/` | GET | ุญุงูุฉ ุงูุณูุฑูุฑ | ุงุฎุชุจุงุฑ |
| `/config` | GET | ุฅุนุฏุงุฏุงุช ุนุงูุฉ | ุงูุชุทุจูู |
| `/ads` | GET | ุฅุนุฏุงุฏุงุช ุงูุฅุนูุงูุงุช | ุงูุชุทุจูู |
| `/doctor` | POST | ุงูุฏุฑุฏุดุฉ ูุน ุงูุทุจูุจ | ุงูุชุทุจูู |
| `/analyze` | POST | ุชุญููู ุตูุฑุฉ ูุจุงุช | ุงูุชุทุจูู |
| `/api/diagnose` | POST | ุชุญููู ุตูุฑุฉ (ุจุฏูู) | ุงูุชุทุจูู |

---

## ๐ ุงูุฃูุงู

### โ Client-Side (ุงูุชุทุจูู):
- โ ูุง ูุญุชูู ุนูู ุฃู OpenAI API Key
- โ ูุง ูุญุชูู ุนูู ุฃู Google Sheets URL
- โ ููุท ูุฑุณู ุทูุจุงุช ุฅูู ุงูุณูุฑูุฑ
- โ ุขูู ูููุดุฑ ูู APK

### โ Server-Side (Render):
- โ OpenAI API Key ูู Environment Variables
- โ Google Sheets URL ูู Environment Variables
- โ ูุง ูุชู ุชุฎุฒูู ุฃู ููุงุชูุญ ูู ุงูููุฏ
- โ ุขูู ุนูู ุงูุณูุฑูุฑ

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

| ุงูููู | ุงูุญุงูุฉ | ููุน ุงูุชุนุฏูู |
|-------|--------|-------------|
| `config.js` | โ ุจุฏูู ุชุนุฏูู | - |
| `helper.js` | โ ุจุฏูู ุชุนุฏูู | - |
| `api.js` | โ ุจุฏูู ุชุนุฏูู | - |
| `index.js` | โ ุจุฏูู ุชุนุฏูู | - |
| `doctor.js` | โ๏ธ ูุนุฏู ุจุงููุงูู | ุชุญููู ูู Server ุฅูู Client |
| `analyze.js` | โ๏ธ ูุนุฏู ุจุงููุงูู | ุชุญููู ูู Server ุฅูู Client |
| `ads.js` | โ๏ธ ูุนุฏู ุจุงููุงูู | ุชุญููู ูู Server ุฅูู Client |
| `server.js` | โ๏ธ ูุนุฏู ุฌุฒุฆูุงู | ุชุญุฏูุซ ูุณุงุฑุงุช ุงูู handlers |
| `server-handlers/doctor.handler.js` | โจ ุฌุฏูุฏ | Server handler |
| `server-handlers/analyze.handler.js` | โจ ุฌุฏูุฏ | Server handler |
| `server-handlers/ads.handler.js` | โจ ุฌุฏูุฏ | Server handler |
| `STRUCTURE.md` | โจ ุฌุฏูุฏ | ุชูุซูู |

---

## ๐ ุงููุชุงุฆุฌ

### โ ุชู ุฅุตูุงุญ:
1. โ ุฎุทุฃ "failed to analyze, please try again"
2. โ ุฎุทุฃ "Sorry, chat service is currently unavailable"
3. โ ูุตู Client-Side ุนู Server-Side ุจุดูู ูุงูู
4. โ ุฅุฒุงูุฉ ุฌููุน API Keys ูู ุงูุชุทุจูู
5. โ ุชูุญูุฏ ุฑุงุจุท ุงูุณูุฑูุฑ ูู ููู ูุงุญุฏ
6. โ ุฌููุน ุงูุทูุจุงุช ุชุณุชุฎุฏู `https://my-cordova.onrender.com`

### ๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู:
- โ ุงูุชุทุจูู ุฌุงูุฒ ููุชุดุบูู
- โ ุงูุณูุฑูุฑ ุฌุงูุฒ ูููุดุฑ ุนูู Render
- โ ูุง ุญุงุฌุฉ ูุฃู ุชุนุฏููุงุช ุฅุถุงููุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชุญุฐู ูุฌูุฏ `server-handlers/`**: ูุญุชูู ุนูู ูููุงุช ุงูุณูุฑูุฑ ุงูุถุฑูุฑูุฉ
2. **ูุง ุชุนุฏู `config.js`**: ูุญุชูู ุนูู ุงูุฑุงุจุท ุงูุตุญูุญ ููุณูุฑูุฑ
3. **ุนูู Render**: ุชุฃูุฏ ูู ูุฌูุฏ `OPENAI_API_KEY` ูู Environment Variables
4. **ูู ุงูุชุทุจูู**: ุงุณุชุฎุฏู `api.js` ุฃู `index.js` ูุจุงุดุฑุฉ

---

## ๐งช ููุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ:
```javascript
const CordovaAPI = require('./index');

// ุงุฎุชุจุงุฑ ุงูุฏุฑุฏุดุฉ
const chatResult = await CordovaAPI.askDoctor('ูุฑุญุจุงู', 'ar');
console.log(chatResult);

// ุงุฎุชุจุงุฑ ุงูุชุญููู
const analyzeResult = await CordovaAPI.analyzePlant(base64Image, 'ar');
console.log(analyzeResult);

// ุงุฎุชุจุงุฑ ุงูุฅุนูุงูุงุช
const adsResult = await CordovaAPI.getAdsConfig();
console.log(adsResult);
```

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: 2025-12-07  
**ุงูุญุงูุฉ**: โ ุฌููุน ุงูุฃุฎุทุงุก ุชู ุฅุตูุงุญูุง ุจูุฌุงุญ
